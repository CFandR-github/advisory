<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 6.2.6.2 (Linux)"/>
	<meta name="created" content="2022-05-18T04:16:04.264905700"/>
	<meta name="changed" content="2022-05-20T03:22:58.805654374"/>
	<style type="text/css">
		@page { size: 8.5in 11in; margin: 0.79in }
		p { margin-bottom: 0.1in; direction: ltr; color: #000000; line-height: 115%; orphans: 2; widows: 2; background: transparent }
		p.western { font-family: "Liberation Serif", "Times New Roman", serif; font-size: 12pt; so-language: en-US }
		p.cjk { font-family: "Noto Sans CJK SC Regular"; font-size: 12pt; so-language: zh-CN }
		p.ctl { font-family: "FreeSans"; font-size: 12pt; so-language: hi-IN }
		a:link { color: #000080; so-language: zxx; text-decoration: underline }
		a:visited { color: #800000; so-language: zxx; text-decoration: underline }
	</style>
</head>
<body lang="en-US" text="#000000" link="#000080" vlink="#800000" bgcolor="#ffffff" dir="ltr"><p class="western" style="margin-bottom: 0in; line-height: 100%">
<br/>

</p>
<p class="western" align="center" style="margin-bottom: 0in; line-height: 100%">
<b>Variable rewrite with boolean and GMP Type Confusion</b></p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">To
build exploit for PHP Type Confusion bug we need to find in code:</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">1)
Class that implements Serializable interface</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">2)
Code line executed from __destruct method to rewrite object property</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">3)
Find an object to rewrite props</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">Symfony
package “symfony/dependency-injection” was taken for analysis.</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">This
class has small number of __destruct methods. And it has code line to
write property field into another property field, reachable from
__destruct.</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">But
project has line:</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">$this-&gt;removedBindingIds[(int)
$bindingId] = true;    
</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">in  
<span style="font-weight: normal">removeBindings method.</span></p>
<p class="western" style="margin-bottom: 0in; font-weight: normal; line-height: 100%">
It is enough to rewrite handle of GMP object.In the finish of GMP
deserialization we rewrite Composer object props, because it has
handle = 0x1.</p>
<p class="western" style="margin-bottom: 0in; font-weight: normal; line-height: 100%">
Exploit build process is very similar with expoitation discussed in
previous advisory.</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">  
</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">F<img src="symfony_rewrite_with_boolean_html_8b30648a0d0f50db.png" name="Image1" align="left" width="665" height="181" border="0"/>
ile
symfony/dependency-injection/Loader/Configurator/ServiceConfigurator.php</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%">File
symfony/dependency-injection/ContainerBuilder.php:</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><img src="symfony_rewrite_with_boolean_html_cebc0233944efb9a.png" name="Image2" align="left" width="665" height="130" border="0"/>
<br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p class="western" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
</body>
</html>